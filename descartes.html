<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Descartar - Sistema de Registro</title>

    <script>
        // Script para prevenir el "flash" del tema oscuro
        (function() {
            try {
                const theme = localStorage.getItem('theme');
                if (theme === 'dark') {
                    document.documentElement.classList.add('dark-mode');
                }
            } catch (e) {
                // No hacer nada si localStorage no est√° disponible
            }
        })();
    </script>

    <link rel="stylesheet" href="css/global.css">
    <link rel="stylesheet" href="css/descartes.css">

    <link rel="icon" href="assets/icons/icon-192.png">
</head>
<body class="page-descartes-inicio">
    <div id="navbar-placeholder"></div>

    <div id="loader" class="loader-wrapper">
        <div class="loader"></div>
    </div>

    <main id="main-content" style="display: none;">
        <div class="container">
            <h1>Registro de Descartes</h1>

            <div id="inicio-descarte-section" class="content-center">
                <button id="btn-iniciar-descarte" class="btn-iniciar">
                    ‚ûï Iniciar Nuevo Descarte
                </button>
            </div>

            <div id="registro-equipos-section" class="content-center" style="display: none;">

                <h4 class="session-indicator">
                    Registrando equipos para la Sesi√≥n #<span id="active-session-id"></span>
                </h4>

                <form id="form-equipo" class="form-equipo" novalidate>
                    <h2>A√±adir Equipo</h2>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="descripcion">Descripci√≥n:</label>
                            <input type="text" id="descripcion" placeholder="Ej: CPU, Monitor...">
                        </div>
                        
                        <div class="form-group">
                            <label for="marbete">Marbete:</label>
                            <div class="input-with-button">
                                <input type="text" id="marbete" placeholder="N√∫mero de marbete">
                                <button type="button" class="btn-scan" data-target-input="marbete">üî≥</button>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="serie">Serie:</label>
                            <div class="input-with-button">
                                <input type="text" id="serie" placeholder="N√∫mero de serie">
                                <button type="button" class="btn-scan" data-target-input="serie">üî≥</button>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="marca">Marca:</label>
                            <input type="text" id="marca" placeholder="Ej: Dell, HP...">
                        </div>
                        <div class="form-group">
                            <label for="modelo">Modelo:</label>
                            <input type="text" id="modelo" placeholder="Ej: Optiplex 7010">
                        </div>
                    </div>
                    <div class="form-group-full">
                        <label for="estado_equipo">Estado del Equipo:</label>
                        <input type="text" id="estado_equipo" placeholder="Describe la condici√≥n f√≠sica">
                    </div>
                    <div class="form-group-full">
                        <label for="motivo_descarte">Motivo del Descarte (Evaluaci√≥n):</label>
                        <input type="text" id="motivo_descarte" placeholder="Describe la falla t√©cnica">
                    </div>
                    <button type="submit" id="btn-anadir-equipo" class="btn-principal">A√±adir Equipo</button>
                </form>

                <div class="finalizar-seccion">
                   <label for="observacion">Observaci√≥n General:</label>
                   <textarea id="observacion" rows="3" placeholder="A√±ade cualquier observaci√≥n relevante..."></textarea>
                   <button id="btn-finalizar-descarte" class="btn-finalizar">Finalizar Descarte</button>
               </div>

                <div class="tabla-equipos-wrapper">
                    <h3>Equipos Registrados (<span id="contador-equipos">0</span>)</h3>
                    <div class="table-container">
                        <table id="tabla-equipos">
                            <thead>
                                <tr>
                                    <th>N¬∫</th>
                                    <th>Descripci√≥n</th>
                                    <th>Marbete</th>
                                    <th>Serie</th>
                                    <th>Marca</th>
                                    <th>Modelo</th>
                                    <th>Estado</th>
                                    <th>Motivo</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody>
                                </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <div id="modal-nueva-sesion" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <button id="btn-cerrar-modal" class="modal-close-btn">&times;</button>
            <h2>Crear Nueva Sesi√≥n de Descarte</h2>
            <form id="form-nueva-sesion" novalidate>
                <label for="unidad_administrativa">Unidad Administrativa:</label>
                <input type="text" id="unidad_administrativa" placeholder="Introduce el nombre de la escuela" required>
                <label for="siace_code">C√≥digo SIACE:</label>
                <input type="text" id="siace_code" placeholder="Introduce el c√≥digo de la escuela" required>
                <button type="submit" class="btn-principal">Crear Sesi√≥n</button>
            </form>
        </div>
    </div>

    <div id="modal-confirmacion" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <h2 id="confirm-title">¬øEst√°s seguro?</h2>
            <p id="confirm-message">Esta acci√≥n no se puede deshacer.</p>
            <div class="modal-buttons">
                <button id="btn-confirmar-cancelar" class="btn-secondary">Cancelar</button>
                <button id="btn-confirmar-aceptar" class="btn-danger">Aceptar</button>
            </div>
        </div>
    </div>

    <div id="modal-editar-equipo" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <button id="btn-cerrar-modal-editar" class="modal-close-btn">&times;</button>
            <h2>Editar Equipo</h2>
            <form id="form-editar-equipo" novalidate>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="edit-descripcion">Descripci√≥n:</label>
                        <input type="text" id="edit-descripcion">
                    </div>
                    <div class="form-group">
                        <label for="edit-marbete">Marbete:</label>
                        <input type="text" id="edit-marbete">
                    </div>
                    <div class="form-group">
                        <label for="edit-serie">Serie:</label>
                        <input type="text" id="edit-serie">
                    </div>
                    <div class="form-group">
                        <label for="edit-marca">Marca:</label>
                        <input type="text" id="edit-marca">
                    </div>
                    <div class="form-group">
                        <label for="edit-modelo">Modelo:</label>
                        <input type="text" id="edit-modelo">
                    </div>
                </div>
                <div class="form-group-full">
                    <label for="edit-estado_equipo">Estado del Equipo:</label>
                    <input type="text" id="edit-estado_equipo">
                </div>
                <div class="form-group-full">
                    <label for="edit-motivo_descarte">Motivo del Descarte:</label>
                    <input type="text" id="edit-motivo_descarte">
                </div>
                <div class="modal-buttons">
                    <button type="button" id="btn-editar-cancelar" class="btn-secondary">Cancelar</button>
                    <button type="submit" class="btn-principal">Aplicar Cambios</button>
                </div>
            </form>
        </div>
    </div>
    
    <div id="modal-scanner" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <button id="btn-cerrar-scanner" class="modal-close-btn">&times;</button>
            <h2>Escaneando C√≥digo de Barras</h2>
            <video id="video-scanner" style="width: 100%; border-radius: 8px;"></video>
            <p>Apunta la c√°mara al c√≥digo de barras.</p>
        </div>
    </div>

    <div id="toast-notification" class="toast">
        <span id="toast-message"></span>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/@zxing/library@0.20.0/umd/zxing.min.js"></script>
    <script src="js/common.js" defer></script>
    <script src="js/descartes.js" defer></script>
</body>
</html>